<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Amigo Secreto</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; margin: 50px; }
        input, button { margin: 10px; padding: 10px; }
        #links { margin-top: 20px; white-space: pre-wrap; }
        .whatsapp-link { color: #25D366; text-decoration: none; font-weight: bold; }
    </style>
</head>
<body>
    <h1>Admin - Gerar Amigo Secreto üéÑ</h1>
    <p>Insira os participantes (nome e telefone, um por linha, separados por v√≠rgula). Ex: Jo√£o,11987654321</p>
    <textarea id="dados" rows="10" cols="40" placeholder="Jo√£o,11987654321&#10;Maria,11987654322&#10;Pedro,11987654323&#10;..."></textarea><br>
    <button onclick="gerarSorteio()">Gerar Sorteio e Links do WhatsApp</button>
    <div id="links"></div>

    <script>
        function gerarSorteio() {
            const dadosTexto = document.getElementById('dados').value.trim();
            if (!dadosTexto) {
                alert('Insira pelo menos 2 participantes com nome e telefone!');
                return;
            }
            const linhas = dadosTexto.split('\n').map(l => l.trim()).filter(l => l);
            const participantes = [];
            const telefones = {};
            for (let linha of linhas) {
                const partes = linha.split(',');
                if (partes.length !== 2) {
                    alert('Formato inv√°lido! Use: Nome,Telefone');
                    return;
                }
                const nome = partes[0].trim();
                const tel = partes[1].trim().replace(/\D/g, ''); // Remove n√£o-d√≠gitos
                if (!nome || !tel || tel.length < 10) {
                    alert('Nome ou telefone inv√°lido!');
                    return;
                }
                participantes.push(nome);
                telefones[nome] = tel;
            }
            if (participantes.length < 2) {
                alert('Precisa de pelo menos 2 participantes!');
                return;
            }

            // Gera atribui√ß√µes √∫nicas (ningu√©m tira o pr√≥prio nome)
            let disponiveis = [...participantes];
            let atribuicoes = {};
            for (let nome of participantes) {
                let index;
                do {
                    index = Math.floor(Math.random() * disponiveis.length);
                } while (disponiveis[index] === nome);
                atribuicoes[nome] = disponiveis.splice(index, 1)[0];
            }

            // Gera IDs √∫nicos, links secretos e links do WhatsApp
            let output = 'Clique nos links abaixo para enviar via WhatsApp:\n\n';
            participantes.forEach((nome) => {
                const uniqueId = crypto.randomUUID(); // ID √∫nico
                const data = btoa(JSON.stringify({ attr: atribuicoes[nome] })); // Codifica o nome
                // Cria link relativo/din√¢mico para evitar problemas com caixa/nomes de reposit√≥rio
                const basePath = location.origin + location.pathname.substring(0, location.pathname.lastIndexOf('/'));
                const linkSecreto = `${basePath}/index.html?id=${uniqueId}&data=${encodeURIComponent(data)}`;
                const mensagem = encodeURIComponent(`Ol√° ${nome}, seu link secreto do amigo secreto √©: ${linkSecreto}. Abra apenas voc√™! üéÑ`);
                const linkWhatsApp = `https://wa.me/55${telefones[nome]}?text=${mensagem}`;
                output += `${nome}: <a href="${linkWhatsApp}" target="_blank" class="whatsapp-link">Enviar para ${nome} via WhatsApp</a>\n`;
            });

            document.getElementById('links').innerHTML = output;
        }
    </script>
</body>
</html>