<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Amigo Secreto</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; margin: 50px; }
        input, button { margin: 10px; padding: 10px; }
        #links { margin-top: 20px; white-space: pre-wrap; }
        .whatsapp-link { color: #25D366; text-decoration: none; font-weight: bold; }
    </style>
</head>
<body>
    <h1>Admin - Gerar Amigo Secreto ðŸŽ„</h1>
    <p>Insira os participantes (nome e telefone, um por linha, separados por vÃ­rgula). Ex: JoÃ£o,11987654321</p>
    <textarea id="dados" rows="10" cols="40" placeholder="JoÃ£o,11987654321&#10;Maria,11987654322&#10;Pedro,11987654323&#10;..."></textarea><br>
    <button onclick="gerarSorteio()">Gerar Sorteio e Links do WhatsApp</button>
    <div id="links"></div>

    <script>
        function gerarSorteio() {
            const dadosTexto = document.getElementById('dados').value.trim();
            if (!dadosTexto) {
                alert('Insira pelo menos 2 participantes com nome e telefone!');
                return;
            }
            const linhas = dadosTexto.split('\n').map(l => l.trim()).filter(l => l);
            const participantes = [];
            const telefones = {};
            for (let linha of linhas) {
                const partes = linha.split(',');
                if (partes.length !== 2) {
                    alert('Formato invÃ¡lido! Use: Nome,Telefone');
                    return;
                }
                const nome = partes[0].trim();
                const tel = partes[1].trim().replace(/\D/g, ''); // Remove nÃ£o-dÃ­gitos
                if (!nome || !tel || tel.length < 10) {
                    alert('Nome ou telefone invÃ¡lido!');
                    return;
                }
                participantes.push(nome);
                telefones[nome] = tel;
            }
            if (participantes.length < 2) {
                alert('Precisa de pelo menos 2 participantes!');
                return;
            }

            // Gera atribuiÃ§Ãµes Ãºnicas (ninguÃ©m tira o prÃ³prio nome)
            let disponiveis = [...participantes];
            let atribuicoes = {};
            for (let nome of participantes) {
                let index;
                do {
                    index = Math.floor(Math.random() * disponiveis.length);
                } while (disponiveis[index] === nome);
                atribuicoes[nome] = disponiveis.splice(index, 1)[0];
            }

            // Gera IDs Ãºnicos, links secretos e links do WhatsApp
            let output = 'Clique nos links abaixo para enviar via WhatsApp:\n\n';
            participantes.forEach((nome) => {
                const uniqueId = crypto.randomUUID(); // ID Ãºnico
                const data = btoa(JSON.stringify({ attr: atribuicoes[nome] })); // Codifica o nome
                const linkSecreto = `https://SEU-USUARIO.github.io/amigo-secreto/index.html?id=${uniqueId}&data=${data}`; // Substitua pela sua URL
                const mensagem = encodeURIComponent(`OlÃ¡ ${nome}, seu link secreto do amigo secreto Ã©: ${linkSecreto}. Abra apenas vocÃª! ðŸŽ„`);
                const linkWhatsApp = `https://wa.me/55${telefones[nome]}?text=${mensagem}`;
                output += `${nome}: <a href="${linkWhatsApp}" target="_blank" class="whatsapp-link">Enviar para ${nome} via WhatsApp</a>\n`;
            });

            document.getElementById('links').innerHTML = output;
        }
    </script>
</body>
</html>